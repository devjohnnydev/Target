{% extends "base.html" %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div
        class="flex flex-col lg:flex-row justify-between items-start lg:items-center bg-slate-900/50 p-8 rounded-[2.5rem] border border-white/5 backdrop-blur-md gap-6">
        <div>
            <h1 class="text-3xl font-futuristic text-white mb-2 uppercase tracking-tight italic">Gestão de <span
                    class="text-blue-400">Usuários</span></h1>
            <p class="text-slate-500 font-bold text-[10px] uppercase tracking-[0.3em]">Controle Total de Professores e
                Alunos</p>
        </div>
        <div class="flex items-center space-x-4">
            <div class="bg-white/5 px-6 py-3 rounded-2xl border border-white/5 text-center">
                <span class="text-slate-500 font-bold text-[8px] uppercase tracking-[0.2em] block">Alunos</span>
                <span class="text-xl font-futuristic text-white">{{ total_students }}</span>
            </div>
            <div class="bg-white/5 px-6 py-3 rounded-2xl border border-white/5 text-center">
                <span class="text-slate-500 font-bold text-[8px] uppercase tracking-[0.2em] block">Professores</span>
                <span class="text-xl font-futuristic text-white">{{ total_teachers }}</span>
            </div>
            <a href="{{ url_for('admin_dashboard') }}"
                class="bg-white/5 hover:bg-white/10 text-white font-futuristic py-4 px-6 rounded-2xl text-[9px] border border-white/10 transition-all uppercase tracking-widest italic">
                ← Voltar Dashboard
            </a>
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-slate-900/40 rounded-[2.5rem] border border-white/5 p-8">
        <form method="GET" action="{{ url_for('admin_users') }}"
            class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
            <div class="space-y-2">
                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1">Buscar por
                    Nome/Email</label>
                <input type="text" name="search" value="{{ current_search or '' }}" placeholder="Ex: João da Silva..."
                    class="w-full bg-slate-950/50 border border-white/10 rounded-xl px-4 py-3 text-white text-xs outline-none focus:border-blue-500/30">
            </div>
            <div class="space-y-2">
                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1">Filtrar por
                    Função</label>
                <select name="role"
                    class="w-full bg-slate-950/50 border border-white/10 rounded-xl px-4 py-3 text-white text-xs outline-none focus:border-blue-500/30">
                    <option value="">TODOS OS USUÁRIOS</option>
                    <option value="student" {% if current_role=='student' %}selected{% endif %}>ALUNOS</option>
                    <option value="teacher" {% if current_role=='teacher' %}selected{% endif %}>PROFESSORES</option>
                    <option value="admin" {% if current_role=='admin' %}selected{% endif %}>ADMINISTRADORES</option>
                </select>
            </div>
            <button type="submit"
                class="bg-blue-600 hover:bg-blue-500 text-white font-futuristic py-3.5 rounded-xl text-[10px] uppercase tracking-widest transition-all">
                Filtrar Usuários
            </button>
        </form>
    </div>

    <!-- Users Table -->
    <div class="bg-slate-900/40 rounded-[2.5rem] border border-white/5 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="text-slate-500 uppercase text-[10px] font-bold tracking-widest border-b border-white/5">
                        <th class="px-8 py-5">Usuário</th>
                        <th class="px-8 py-5">Função</th>
                        <th class="px-8 py-5">Cadastro</th>
                        <th class="px-8 py-5 text-right">Ações</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for user in users %}
                    <tr class="hover:bg-white/5 transition-colors group">
                        <td class="px-8 py-6">
                            <div class="flex items-center space-x-4">
                                <div
                                    class="w-10 h-10 rounded-full border border-white/5 overflow-hidden bg-white/5 flex-shrink-0">
                                    {% if user.photo_url %}
                                    <img src="{{ user.photo_url if (user.profile_image_type == 'url' or user.photo_url.startswith('http')) else url_for('static', filename='uploads/profiles/' + user.photo_url) }}"
                                        class="w-full h-full object-cover">
                                    {% else %}
                                    <div
                                        class="w-full h-full flex items-center justify-center text-slate-500 text-[10px] font-bold">
                                        {{ user.name[:2].upper() }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div>
                                    <div
                                        class="font-futuristic text-white text-xs uppercase italic group-hover:text-blue-400 transition-colors">
                                        {{ user.name }}</div>
                                    <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">{{
                                        user.email }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-8 py-6">
                            {% if user.role == 'admin' %}
                            <span
                                class="text-rose-400 text-[9px] font-bold uppercase tracking-[0.2em] bg-rose-400/10 px-3 py-1 rounded-full border border-rose-400/20">Admin</span>
                            {% elif user.role == 'teacher' %}
                            <span
                                class="text-indigo-400 text-[9px] font-bold uppercase tracking-[0.2em] bg-indigo-400/10 px-3 py-1 rounded-full border border-indigo-400/20">Professor</span>
                            {% else %}
                            <span
                                class="text-emerald-400 text-[9px] font-bold uppercase tracking-[0.2em] bg-emerald-400/10 px-3 py-1 rounded-full border border-emerald-400/20">Aluno</span>
                            {% endif %}
                        </td>
                        <td class="px-8 py-6 text-[10px] text-slate-500 font-bold font-mono">{{
                            user.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td class="px-8 py-6 text-right">
                            <div class="flex justify-end items-center space-x-3">
                                <form action="{{ url_for('admin_delete_user', user_id=user.id) }}" method="POST"
                                    onsubmit="return confirm('Tem certeza que deseja deletar este usuário? Esta ação é irreversível.')">
                                    <button type="submit"
                                        class="bg-rose-500/10 hover:bg-rose-500 text-rose-500 hover:text-white p-2.5 rounded-xl transition-all border border-rose-500/20"
                                        title="Excluir Usuário">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if not users %}
                    <tr>
                        <td colspan="4" class="px-8 py-20 text-center">
                            <p class="text-slate-600 italic text-xs">Nenhum usuário encontrado com os filtros aplicados.
                            </p>
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}